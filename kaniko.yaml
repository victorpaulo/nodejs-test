apiVersion: batch/v1
kind: Job
metadata:
  name: build-job
  labels:
    app: kaniko-example
spec:
  template:
    spec:
      containers:
      - name: build
        image: gcr.io/kaniko-project/executor:latest
        args: ["-c", "/workspace/build/", "--insecure", "-d", "kind-registry:5000/nodejs-test:1.0"]
        # env:
        # - name: DOCKER_CONFIG
        #   value: "/kaniko/secrets"
        volumeMounts:
        - name: build-context
          mountPath: /workspace
        # - name: docker-config
        #   mountPath: "/kaniko/secrets"
        #   readOnly: true
      initContainers:
      - name: clone
        image: alpine:3.7
        command: ["/bin/sh","-c"]
        args: ['apk add --no-cache git && git clone https://github.com/victorpaulo/nodejs-test.git /workspace/build/']
        volumeMounts:
        - name: build-context
          mountPath: /workspace
      restartPolicy: Never
      volumes:
      - name: build-context
        emptyDir: {}
      # - name: docker-config
      #   secret:
      #     secretName: docker-config